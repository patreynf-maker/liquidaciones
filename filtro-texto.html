<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filtro de Líneas</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0d0d;
    --panel: #161616;
    --border: #2a2a2a;
    --accent: #e8ff3c;
    --accent2: #3cffb4;
    --text: #e8e8e8;
    --muted: #666;
    --danger: #ff4c4c;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    padding: 40px 20px;
  }

  header {
    text-align: center;
    margin-bottom: 48px;
  }

  header h1 {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    letter-spacing: -2px;
    line-height: 1;
  }

  header h1 span {
    color: var(--accent);
  }

  header p {
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 0.8rem;
    margin-top: 10px;
    letter-spacing: 1px;
  }

  .container {
    max-width: 1100px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
  }

  @media (max-width: 768px) {
    .container { grid-template-columns: 1fr; }
  }

  .panel {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .panel-full {
    grid-column: 1 / -1;
  }

  .panel-label {
    font-size: 0.7rem;
    font-family: 'Space Mono', monospace;
    letter-spacing: 3px;
    color: var(--accent);
    text-transform: uppercase;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .panel-label::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--accent);
    border-radius: 50%;
    display: inline-block;
  }

  textarea {
    background: #0d0d0d;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.78rem;
    line-height: 1.7;
    padding: 16px;
    resize: vertical;
    min-height: 260px;
    width: 100%;
    transition: border-color 0.2s;
    outline: none;
  }

  textarea:focus {
    border-color: var(--accent);
  }

  textarea[readonly] {
    cursor: default;
    color: var(--accent2);
  }

  .search-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 36px;
    align-items: center;
  }

  .tag {
    background: #1e1e1e;
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 4px 12px;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: tagIn 0.2s ease;
  }

  @keyframes tagIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .tag button {
    background: none;
    border: none;
    color: var(--danger);
    cursor: pointer;
    font-size: 1rem;
    line-height: 1;
    padding: 0;
  }

  .input-row {
    display: flex;
    gap: 8px;
  }

  .input-row input {
    flex: 1;
    background: #0d0d0d;
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Space Mono', monospace;
    font-size: 0.82rem;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .input-row input:focus { border-color: var(--accent); }

  .input-row input::placeholder { color: var(--muted); }

  button.add-btn {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    transition: opacity 0.2s, transform 0.1s;
  }

  button.add-btn:hover { opacity: 0.85; }
  button.add-btn:active { transform: scale(0.97); }

  .options-row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }

  .option {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    color: var(--muted);
    cursor: pointer;
    user-select: none;
  }

  .option input[type=checkbox] {
    accent-color: var(--accent);
    width: 15px; height: 15px;
    cursor: pointer;
  }

  .btn-main {
    background: var(--accent);
    color: #000;
    border: none;
    border-radius: 10px;
    padding: 16px 32px;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.2s;
    width: 100%;
  }

  .btn-main:hover { background: #f5ff70; transform: translateY(-1px); }
  .btn-main:active { transform: translateY(0); }
  .btn-main:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

  .btn-secondary {
    background: transparent;
    color: var(--accent2);
    border: 1px solid var(--accent2);
    border-radius: 10px;
    padding: 14px 24px;
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover { background: var(--accent2); color: #000; }
  .btn-secondary:disabled { opacity: 0.3; cursor: not-allowed; }

  .stats-bar {
    display: flex;
    gap: 24px;
    flex-wrap: wrap;
    padding: 16px 20px;
    background: #111;
    border: 1px solid var(--border);
    border-radius: 10px;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
  }

  .stat { display: flex; flex-direction: column; gap: 4px; }
  .stat-value { font-size: 1.4rem; font-weight: 700; font-family: 'Syne', sans-serif; }
  .stat-label { color: var(--muted); letter-spacing: 1px; }
  .stat-value.good { color: var(--accent2); }
  .stat-value.bad { color: var(--danger); }
  .stat-value.neutral { color: var(--accent); }

  .upload-btn {
    background: transparent;
    border: 1px dashed var(--border);
    border-radius: 8px;
    color: var(--muted);
    cursor: pointer;
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    padding: 10px 16px;
    transition: all 0.2s;
    letter-spacing: 1px;
  }

  .upload-btn:hover { border-color: var(--accent); color: var(--accent); }

  .actions-row {
    display: flex;
    gap: 12px;
  }

  .actions-row .btn-main { flex: 2; }
  .actions-row .btn-secondary { flex: 1; }

  #file-input { display: none; }

  .empty-state {
    text-align: center;
    color: var(--muted);
    font-family: 'Space Mono', monospace;
    font-size: 0.75rem;
    padding: 40px 0;
    border: 1px dashed var(--border);
    border-radius: 8px;
    letter-spacing: 1px;
  }
</style>
</head>
<body>

<header>
  <h1>FILTRO DE <span>LÍNEAS</span></h1>
  <p>// conserva solo las líneas que contengan las cadenas buscadas</p>
</header>

<div class="container">

  <!-- INPUT -->
  <div class="panel">
    <div class="panel-label">Texto de entrada</div>
    <textarea id="input-text" placeholder="Pegá aquí el contenido del archivo, o usá el botón para cargar un archivo .txt ..."></textarea>
    <div style="display:flex; gap:10px; align-items:center;">
      <button class="upload-btn" onclick="document.getElementById('file-input').click()">↑ CARGAR ARCHIVO .TXT</button>
      <input type="file" id="file-input" accept=".txt,.log,.csv" onchange="loadFile(event)">
      <button class="upload-btn" onclick="clearInput()" style="margin-left:auto;">✕ LIMPIAR</button>
    </div>
  </div>

  <!-- CONFIG -->
  <div class="panel">
    <div class="panel-label">Cadenas a buscar</div>

    <div class="input-row">
      <input type="text" id="search-input" placeholder="Escribí una cadena y presioná Enter o Agregar..." onkeydown="if(event.key==='Enter') addTag()">
      <button class="add-btn" onclick="addTag()">+ Agregar</button>
    </div>

    <div id="tags-container">
      <div class="empty-state" id="empty-tags">Aún no agregaste cadenas de búsqueda</div>
    </div>

    <div class="options-row">
      <label class="option">
        <input type="checkbox" id="opt-case"> Sensible a mayúsculas
      </label>
      <label class="option">
        <input type="checkbox" id="opt-regex"> Usar expresiones regulares
      </label>
    </div>

    <div id="stats-container" style="display:none">
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-value neutral" id="stat-total">0</span>
          <span class="stat-label">TOTAL</span>
        </div>
        <div class="stat">
          <span class="stat-value good" id="stat-kept">0</span>
          <span class="stat-label">CONSERVADAS</span>
        </div>
        <div class="stat">
          <span class="stat-value bad" id="stat-removed">0</span>
          <span class="stat-label">ELIMINADAS</span>
        </div>
        <div class="stat">
          <span class="stat-value neutral" id="stat-pct">0%</span>
          <span class="stat-label">REDUCCIÓN</span>
        </div>
      </div>
    </div>
  </div>

  <!-- OUTPUT -->
  <div class="panel panel-full">
    <div class="panel-label">Resultado</div>

    <div id="output-empty" class="empty-state">
      El resultado aparecerá aquí después de filtrar
    </div>

    <textarea id="output-text" style="display:none; min-height:300px;" readonly placeholder="Resultado..."></textarea>

    <div class="actions-row">
      <button class="btn-main" onclick="runFilter()">⚡ FILTRAR AHORA</button>
      <button class="btn-secondary" id="btn-download" onclick="downloadResult()" disabled>↓ DESCARGAR RESULTADO</button>
    </div>
  </div>

</div>

<script>
  let tags = [];

  function addTag() {
    const input = document.getElementById('search-input');
    const val = input.value.trim();
    if (!val || tags.includes(val)) { input.value = ''; return; }
    tags.push(val);
    input.value = '';
    renderTags();
  }

  function removeTag(i) {
    tags.splice(i, 1);
    renderTags();
  }

  function renderTags() {
    const container = document.getElementById('tags-container');
    const empty = document.getElementById('empty-tags');

    if (tags.length === 0) {
      container.innerHTML = '';
      container.appendChild(empty);
      return;
    }

    container.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.className = 'search-tags';
    tags.forEach((t, i) => {
      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.innerHTML = `<span>${escapeHtml(t)}</span><button onclick="removeTag(${i})" title="Eliminar">×</button>`;
      wrap.appendChild(tag);
    });
    container.appendChild(wrap);
  }

  function escapeHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function loadFile(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      document.getElementById('input-text').value = ev.target.result;
    };
    reader.readAsText(file, 'UTF-8');
    e.target.value = '';
  }

  function clearInput() {
    document.getElementById('input-text').value = '';
    document.getElementById('output-text').style.display = 'none';
    document.getElementById('output-empty').style.display = 'block';
    document.getElementById('stats-container').style.display = 'none';
    document.getElementById('btn-download').disabled = true;
  }

  function runFilter() {
    const inputText = document.getElementById('input-text').value;
    if (!inputText.trim()) { alert('Por favor ingresá texto primero.'); return; }
    if (tags.length === 0) { alert('Agregá al menos una cadena de búsqueda.'); return; }

    const caseSensitive = document.getElementById('opt-case').checked;
    const useRegex = document.getElementById('opt-regex').checked;

    const lines = inputText.split('\n');
    let matchers;

    try {
      matchers = tags.map(t => {
        if (useRegex) {
          return new RegExp(t, caseSensitive ? '' : 'i');
        } else {
          const escaped = t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          return new RegExp(escaped, caseSensitive ? '' : 'i');
        }
      });
    } catch(err) {
      alert('Error en expresión regular: ' + err.message);
      return;
    }

    const kept = lines.filter(line => matchers.some(rx => rx.test(line)));

    const total = lines.length;
    const keptCount = kept.length;
    const removedCount = total - keptCount;
    const pct = total > 0 ? Math.round((removedCount / total) * 100) : 0;

    document.getElementById('stat-total').textContent = total.toLocaleString();
    document.getElementById('stat-kept').textContent = keptCount.toLocaleString();
    document.getElementById('stat-removed').textContent = removedCount.toLocaleString();
    document.getElementById('stat-pct').textContent = pct + '%';
    document.getElementById('stats-container').style.display = 'block';

    const resultText = kept.join('\n');
    const outTA = document.getElementById('output-text');
    outTA.value = resultText;
    outTA.style.display = 'block';
    document.getElementById('output-empty').style.display = 'none';
    document.getElementById('btn-download').disabled = false;

    outTA.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function downloadResult() {
    const text = document.getElementById('output-text').value;
    if (!text) return;
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'resultado_filtrado.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  }
</script>
</body>
</html>
