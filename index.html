<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filtro de Líneas — YPF</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --blue:    #003087;
    --blue2:   #0047BB;
    --sky:     #009BDE;
    --yellow:  #FFD100;
    --white:   #FFFFFF;
    --light:   #F2F4F7;
    --gray1:   #E4E8EE;
    --gray2:   #C4CDD9;
    --gray3:   #8A9BB0;
    --gray4:   #4A5A6B;
    --dark:    #1C2733;
    --danger:  #C0392B;
    --success: #1A7A4A;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--light);
    color: var(--dark);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
  }

  /* HEADER */
  .header-stripe { height: 4px; background: var(--yellow); }

  header {
    background: var(--blue);
    padding: 20px 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo-wrap { display: flex; align-items: center; gap: 16px; }

  .logo-box {
    background: var(--yellow);
    width: 56px; height: 56px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .logo-box span {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.35rem;
    color: var(--blue);
    letter-spacing: -0.5px;
  }

  .logo-text { border-left: 2px solid var(--gray2); padding-left: 16px; }

  .logo-text h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--white);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .logo-text p {
    font-size: 0.72rem;
    color: var(--gray2);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .header-badge {
    background: var(--gray4);
    color: var(--gray2);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 2px;
    border: 1px solid var(--gray3);
  }

  /* NAV */
  .nav-bar {
    background: var(--dark);
    padding: 9px 48px;
    display: flex;
    align-items: center;
    gap: 6px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .nav-bar span {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--gray3);
  }

  .nav-bar .sep { color: var(--gray4); }
  .nav-bar .active { color: var(--sky); }

  /* MAIN */
  .main {
    max-width: 1180px;
    margin: 0 auto;
    padding: 32px 24px 64px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }

  @media (max-width: 800px) {
    .main { grid-template-columns: 1fr; }
    header { padding: 16px 20px; }
    .nav-bar { padding: 9px 20px; }
  }

  /* CARDS */
  .card {
    background: var(--white);
    border-radius: 3px;
    border-left: 3px solid var(--gray2);
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    padding: 22px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .card-full { grid-column: 1 / -1; }
  .card-primary { border-left-color: var(--blue2); }
  .card-accent  { border-left-color: var(--sky); }

  .card-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gray3);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--gray2);
    border-radius: 50%;
    flex-shrink: 0;
  }

  .card-primary .card-title::before { background: var(--blue2); }
  .card-accent  .card-title::before { background: var(--sky); }

  /* TEXTAREA */
  textarea {
    background: var(--light);
    border: 1px solid var(--gray1);
    border-radius: 3px;
    color: var(--dark);
    font-family: 'Barlow', monospace;
    font-size: 0.79rem;
    line-height: 1.7;
    padding: 12px 14px;
    resize: vertical;
    min-height: 250px;
    width: 100%;
    transition: border-color 0.2s, box-shadow 0.2s;
    outline: none;
  }

  textarea:focus {
    border-color: var(--sky);
    box-shadow: 0 0 0 3px rgba(0,155,222,0.12);
  }

  textarea[readonly] {
    background: #F7F9FB;
    color: var(--dark);
    border-color: var(--gray1);
  }

  /* INPUT */
  .input-row { display: flex; gap: 8px; }

  .input-row input {
    flex: 1;
    background: var(--light);
    border: 1px solid var(--gray1);
    border-radius: 3px;
    color: var(--dark);
    font-family: 'Barlow', sans-serif;
    font-size: 0.86rem;
    padding: 9px 13px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .input-row input:focus {
    border-color: var(--sky);
    box-shadow: 0 0 0 3px rgba(0,155,222,0.12);
  }

  .input-row input::placeholder { color: var(--gray3); }

  /* BUTTONS */
  .btn-add {
    background: var(--blue2);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 9px 18px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.88rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s;
  }

  .btn-add:hover { background: var(--blue); }

  .btn-file {
    background: transparent;
    border: 1px solid var(--gray2);
    border-radius: 3px;
    color: var(--gray3);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 600;
    font-size: 0.75rem;
    letter-spacing: 1px;
    padding: 8px 14px;
    text-transform: uppercase;
    transition: all 0.2s;
  }

  .btn-file:hover { border-color: var(--sky); color: var(--sky); }

  .btn-main {
    background: var(--blue);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 14px 28px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    flex: 2;
  }

  .btn-main:hover { background: var(--blue2); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(0,71,187,0.3); }
  .btn-main:active { transform: translateY(0); }
  .btn-main:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }

  .btn-download {
    background: var(--gray4);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 14px 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.88rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s;
    flex: 1;
  }

  .btn-download:hover { background: var(--dark); }
  .btn-download:disabled { opacity: 0.3; cursor: not-allowed; }

  /* TAGS */
  .tags-wrap { display: flex; flex-wrap: wrap; gap: 7px; min-height: 36px; align-items: center; }

  .tag {
    background: var(--light);
    border: 1px solid var(--gray2);
    border-radius: 2px;
    padding: 4px 8px 4px 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: tagIn 0.15s ease;
  }

  @keyframes tagIn {
    from { transform: scale(0.85); opacity: 0; }
    to   { transform: scale(1);    opacity: 1; }
  }

  .tag button {
    background: none; border: none;
    color: var(--gray3); cursor: pointer;
    font-size: 1rem; line-height: 1; padding: 0;
    transition: color 0.15s;
  }
  .tag button:hover { color: var(--danger); }

  /* OPTIONS */
  .options-row { display: flex; gap: 18px; flex-wrap: wrap; }

  .option {
    display: flex; align-items: center; gap: 7px;
    font-size: 0.81rem; color: var(--gray3);
    cursor: pointer; user-select: none;
  }

  .option input[type=checkbox] { accent-color: var(--blue2); width: 14px; height: 14px; cursor: pointer; }

  /* STATS */
  .stats-bar {
    display: flex;
    border: 1px solid var(--gray1);
    border-radius: 3px;
    overflow: hidden;
    background: var(--light);
  }

  .stat {
    flex: 1;
    padding: 13px 14px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    border-right: 1px solid var(--gray1);
  }
  .stat:last-child { border-right: none; }

  .stat-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1;
    color: var(--dark);
  }

  .stat-value.good { color: var(--success); }
  .stat-value.bad  { color: var(--danger); }
  .stat-value.hl   { color: var(--blue2); }

  .stat-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gray3);
  }

  /* ACTIONS */
  .actions-row { display: flex; gap: 10px; }

  /* EMPTY */
  .empty-state {
    text-align: center;
    color: var(--gray2);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 28px 0;
    border: 1px dashed var(--gray1);
    border-radius: 3px;
  }

  /* FOOTER */
  footer {
    background: var(--dark);
    color: var(--gray4);
    text-align: center;
    padding: 16px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  footer em { color: var(--gray3); font-style: normal; }

  #file-input { display: none; }
</style>
</head>
<body>

<div class="header-stripe"></div>

<header>
  <div class="logo-wrap">
    <div class="logo-box"><span>YPF</span></div>
    <div class="logo-text">
      <h1>Filtro de Líneas</h1>
      <p>Procesamiento de archivos de texto</p>
    </div>
  </div>
  <div class="header-badge">Uso Interno</div>
</header>

<div class="nav-bar">
  <span>YPF S.A.</span>
  <span class="sep">›</span>
  <span>Sistemas</span>
  <span class="sep">›</span>
  <span class="active">Filtro de Archivos</span>
</div>

<div class="main">

  <div class="card card-primary">
    <div class="card-title">Archivo de entrada</div>
    <textarea id="input-text" placeholder="Pegue aquí el contenido del archivo, o utilice el botón para cargar un archivo .txt ..."></textarea>
    <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
      <button class="btn-file" onclick="document.getElementById('file-input').click()">↑ Cargar archivo</button>
      <input type="file" id="file-input" accept=".txt,.log,.csv" onchange="loadFile(event)">
      <button class="btn-file" onclick="clearInput()" style="margin-left:auto;">✕ Limpiar</button>
    </div>
  </div>

  <div class="card card-accent">
    <div class="card-title">Cadenas de búsqueda</div>

    <div class="input-row">
      <input type="text" id="search-input"
        placeholder="Ingrese una cadena y presione Enter o Agregar..."
        onkeydown="if(event.key==='Enter') addTag()">
      <button class="btn-add" onclick="addTag()">+ Agregar</button>
    </div>

    <div id="tags-container">
      <div class="empty-state" id="empty-tags">Sin cadenas definidas</div>
    </div>

    <div class="options-row">
      <label class="option">
        <input type="checkbox" id="opt-case"> Sensible a mayúsculas
      </label>
      <label class="option">
        <input type="checkbox" id="opt-regex"> Expresiones regulares
      </label>
      <label class="option">
        <input type="checkbox" id="opt-header" checked> Conservar encabezado (1ª línea)
      </label>
    </div>

    <div id="stats-container" style="display:none;">
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-value hl" id="stat-total">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat">
          <span class="stat-value good" id="stat-kept">0</span>
          <span class="stat-label">Conservadas</span>
        </div>
        <div class="stat">
          <span class="stat-value bad" id="stat-removed">0</span>
          <span class="stat-label">Eliminadas</span>
        </div>
        <div class="stat">
          <span class="stat-value hl" id="stat-pct">0%</span>
          <span class="stat-label">Reducción</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card card-full">
    <div class="card-title">Resultado del filtrado</div>
    <div id="output-empty" class="empty-state">El resultado aparecerá aquí luego de ejecutar el filtro</div>
    <textarea id="output-text" style="display:none; min-height:300px;" readonly></textarea>
    <div class="actions-row">
      <button class="btn-main" onclick="runFilter()">⚡ Ejecutar filtro</button>
      <button class="btn-download" id="btn-download" onclick="downloadResult()" disabled>↓ Descargar resultado</button>
    </div>
  </div>

</div>

<footer>
  <em>YPF S.A.</em> — Herramienta de uso interno — Gerencia de Sistemas
</footer>

<script>
  let tags = [];

  function addTag() {
    const input = document.getElementById('search-input');
    const val = input.value.trim();
    if (!val || tags.includes(val)) { input.value = ''; return; }
    tags.push(val);
    input.value = '';
    renderTags();
  }

  function removeTag(i) {
    tags.splice(i, 1);
    renderTags();
  }

  function renderTags() {
    const container = document.getElementById('tags-container');
    const empty = document.getElementById('empty-tags');
    if (tags.length === 0) {
      container.innerHTML = '';
      container.appendChild(empty);
      return;
    }
    container.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.className = 'tags-wrap';
    tags.forEach((t, i) => {
      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.innerHTML = `<span>${escapeHtml(t)}</span><button onclick="removeTag(${i})" title="Eliminar">×</button>`;
      wrap.appendChild(tag);
    });
    container.appendChild(wrap);
  }

  function escapeHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  function loadFile(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => { document.getElementById('input-text').value = ev.target.result; };
    reader.readAsText(file, 'UTF-8');
    e.target.value = '';
  }

  function clearInput() {
    document.getElementById('input-text').value = '';
    document.getElementById('output-text').style.display = 'none';
    document.getElementById('output-empty').style.display = 'block';
    document.getElementById('stats-container').style.display = 'none';
    document.getElementById('btn-download').disabled = true;
  }

  function runFilter() {
    const inputText = document.getElementById('input-text').value;
    if (!inputText.trim()) { alert('Por favor ingrese texto primero.'); return; }
    if (tags.length === 0) { alert('Agregue al menos una cadena de búsqueda.'); return; }

    const caseSensitive = document.getElementById('opt-case').checked;
    const useRegex      = document.getElementById('opt-regex').checked;
    const keepHeader    = document.getElementById('opt-header').checked;

    const lines = inputText.split('\n');
    const header = keepHeader && lines.length > 0 ? lines[0] : null;
    const bodyLines = keepHeader ? lines.slice(1) : lines;

    let matchers;
    try {
      matchers = tags.map(t => {
        if (useRegex) return new RegExp(t, caseSensitive ? '' : 'i');
        const escaped = t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        return new RegExp(escaped, caseSensitive ? '' : 'i');
      });
    } catch(err) {
      alert('Error en expresión regular: ' + err.message);
      return;
    }

    const filteredBody = bodyLines.filter(line => matchers.some(rx => rx.test(line)));
    const kept = header !== null ? [header, ...filteredBody] : filteredBody;

    const total        = bodyLines.length;
    const keptCount    = filteredBody.length;
    const removedCount = total - keptCount;
    const pct = total > 0 ? Math.round((removedCount / total) * 100) : 0;

    document.getElementById('stat-total').textContent   = total.toLocaleString('es-AR');
    document.getElementById('stat-kept').textContent    = keptCount.toLocaleString('es-AR');
    document.getElementById('stat-removed').textContent = removedCount.toLocaleString('es-AR');
    document.getElementById('stat-pct').textContent     = pct + '%';
    document.getElementById('stats-container').style.display = 'block';

    const outTA = document.getElementById('output-text');
    outTA.value = kept.join('\n');
    outTA.style.display = 'block';
    document.getElementById('output-empty').style.display = 'none';
    document.getElementById('btn-download').disabled = false;
    outTA.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function downloadResult() {
    const text = document.getElementById('output-text').value;
    if (!text) return;
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'resultado_filtrado.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  }
</script>
</body>
</html>
