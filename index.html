<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filtro de L√≠neas</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --blue:    #003087;
    --blue2:   #0047BB;
    --sky:     #009BDE;
    --yellow:  #FFD100;
    --white:   #FFFFFF;
    --light:   #F2F4F7;
    --gray1:   #E4E8EE;
    --gray2:   #C4CDD9;
    --gray3:   #8A9BB0;
    --gray4:   #4A5A6B;
    --dark:    #1C2733;
    --danger:  #C0392B;
    --success: #1A7A4A;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--light);
    color: var(--dark);
    font-family: 'Barlow', sans-serif;
    min-height: 100vh;
  }

  .header-stripe { height: 4px; background: var(--yellow); }

  header {
    background: var(--blue);
    padding: 20px 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .logo-wrap { display: flex; align-items: center; gap: 16px; }

  .logo-box {
    background: var(--yellow);
    width: 56px; height: 56px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .logo-box span {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 900;
    font-size: 1.35rem;
    color: var(--blue);
    letter-spacing: -0.5px;
  }

  .logo-text { border-left: 2px solid var(--gray2); padding-left: 16px; }

  .logo-text h1 {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    color: var(--white);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .logo-text p {
    font-size: 0.72rem;
    color: var(--gray2);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-top: 2px;
  }

  .header-badge {
    background: var(--gray4);
    color: var(--gray2);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    font-weight: 600;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 2px;
    border: 1px solid var(--gray3);
  }

  .nav-bar {
    background: var(--dark);
    padding: 9px 48px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .nav-bar span {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--gray3);
  }

  .nav-bar .sep { color: var(--gray4); }
  .nav-bar .active { color: var(--sky); }

  .main {
    max-width: 1180px;
    margin: 0 auto;
    padding: 32px 24px 64px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 18px;
  }

  @media (max-width: 800px) {
    .main { grid-template-columns: 1fr; }
    header { padding: 16px 20px; }
    .nav-bar { padding: 9px 20px; }
  }

  .card {
    background: var(--white);
    border-radius: 3px;
    border-left: 3px solid var(--gray2);
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    padding: 22px;
    display: flex;
    flex-direction: column;
    gap: 14px;
  }

  .card-full    { grid-column: 1 / -1; }
  .card-primary { border-left-color: var(--blue2); }
  .card-accent  { border-left-color: var(--sky); }

  .card-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--gray3);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-title::before {
    content: '';
    width: 6px; height: 6px;
    background: var(--gray2);
    border-radius: 50%;
    flex-shrink: 0;
  }

  .card-primary .card-title::before { background: var(--blue2); }
  .card-accent  .card-title::before { background: var(--sky); }

  /* DROP ZONE */
  .drop-zone {
    border: 2px dashed var(--gray2);
    border-radius: 4px;
    padding: 48px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--light);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    user-select: none;
  }

  .drop-zone:hover, .drop-zone.dragover {
    border-color: var(--sky);
    background: #EEF5FB;
  }

  .drop-zone .dz-icon {
    font-size: 2.4rem;
    line-height: 1;
    color: var(--gray3);
  }

  .drop-zone .dz-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--gray4);
  }

  .drop-zone .dz-sub {
    font-size: 0.78rem;
    color: var(--gray3);
    letter-spacing: 0.5px;
  }

  .drop-zone .dz-btn {
    background: var(--blue2);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 8px 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s;
    margin-top: 4px;
  }

  .drop-zone .dz-btn:hover { background: var(--blue); }

  /* FILE LOADED STATE */
  .file-loaded {
    border: 1.5px solid var(--gray1);
    border-radius: 4px;
    padding: 16px 18px;
    background: var(--light);
    display: flex;
    align-items: center;
    gap: 14px;
  }

  .file-icon {
    font-size: 1.8rem;
    line-height: 1;
    flex-shrink: 0;
  }

  .file-info { flex: 1; min-width: 0; }

  .file-name {
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 1rem;
    color: var(--dark);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .file-meta {
    font-size: 0.75rem;
    color: var(--gray3);
    margin-top: 3px;
    letter-spacing: 0.5px;
  }

  .file-remove {
    background: none;
    border: 1px solid var(--gray2);
    border-radius: 3px;
    color: var(--gray3);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 1px;
    padding: 5px 10px;
    text-transform: uppercase;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .file-remove:hover { border-color: var(--danger); color: var(--danger); }

  /* TEXT PREVIEW */
  .preview-box {
    background: var(--light);
    border: 1px solid var(--gray1);
    border-radius: 3px;
    padding: 12px 14px;
    font-family: 'Barlow', monospace;
    font-size: 0.78rem;
    line-height: 1.7;
    color: var(--gray4);
    max-height: 180px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
  }

  .preview-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gray3);
    margin-bottom: 4px;
  }

  /* INPUT ROW */
  .input-row { display: flex; gap: 8px; }

  .input-row input {
    flex: 1;
    background: var(--light);
    border: 1px solid var(--gray1);
    border-radius: 3px;
    color: var(--dark);
    font-family: 'Barlow', sans-serif;
    font-size: 0.86rem;
    padding: 9px 13px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .input-row input:focus {
    border-color: var(--sky);
    box-shadow: 0 0 0 3px rgba(0,155,222,0.12);
  }

  .input-row input::placeholder { color: var(--gray3); }

  /* BUTTONS */
  .btn-add {
    background: var(--blue2);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 9px 18px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.88rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s;
  }

  .btn-add:hover { background: var(--blue); }

  .btn-main {
    background: var(--blue);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 14px 28px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 800;
    font-size: 1rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
    flex: 2;
  }

  .btn-main:hover { background: var(--blue2); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(0,71,187,0.3); }
  .btn-main:active { transform: translateY(0); }
  .btn-main:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }

  .btn-download {
    background: var(--gray4);
    color: var(--white);
    border: none;
    border-radius: 3px;
    padding: 14px 20px;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.88rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    cursor: pointer;
    transition: background 0.2s;
    flex: 1;
  }

  .btn-download:hover { background: var(--dark); }
  .btn-download:disabled { opacity: 0.3; cursor: not-allowed; }

  /* TAGS */
  .tags-wrap { display: flex; flex-wrap: wrap; gap: 7px; min-height: 36px; align-items: center; }

  .tag {
    background: var(--light);
    border: 1px solid var(--gray2);
    border-radius: 2px;
    padding: 4px 8px 4px 12px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 8px;
    animation: tagIn 0.15s ease;
  }

  @keyframes tagIn {
    from { transform: scale(0.85); opacity: 0; }
    to   { transform: scale(1);    opacity: 1; }
  }

  .tag button {
    background: none; border: none;
    color: var(--gray3); cursor: pointer;
    font-size: 1rem; line-height: 1; padding: 0;
    transition: color 0.15s;
  }

  .tag button:hover { color: var(--danger); }

  /* OPTIONS */
  .options-row { display: flex; gap: 18px; flex-wrap: wrap; }

  .option {
    display: flex; align-items: center; gap: 7px;
    font-size: 0.81rem; color: var(--gray3);
    cursor: pointer; user-select: none;
  }

  .option input[type=checkbox] { accent-color: var(--blue2); width: 14px; height: 14px; cursor: pointer; }

  /* STATS */
  .stats-bar {
    display: flex;
    border: 1px solid var(--gray1);
    border-radius: 3px;
    overflow: hidden;
    background: var(--light);
  }

  .stat {
    flex: 1;
    padding: 13px 14px;
    display: flex;
    flex-direction: column;
    gap: 3px;
    border-right: 1px solid var(--gray1);
  }

  .stat:last-child { border-right: none; }

  .stat-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
    line-height: 1;
    color: var(--dark);
  }

  .stat-value.good { color: var(--success); }
  .stat-value.bad  { color: var(--danger); }
  .stat-value.hl   { color: var(--blue2); }

  .stat-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.62rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gray3);
  }

  /* RESULT PREVIEW */
  textarea.result-area {
    background: #F7F9FB;
    border: 1px solid var(--gray1);
    border-radius: 3px;
    color: var(--dark);
    font-family: 'Barlow', monospace;
    font-size: 0.79rem;
    line-height: 1.7;
    padding: 12px 14px;
    resize: vertical;
    min-height: 280px;
    width: 100%;
    outline: none;
  }

  .actions-row { display: flex; gap: 10px; }

  .empty-state {
    text-align: center;
    color: var(--gray2);
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 28px 0;
    border: 1px dashed var(--gray1);
    border-radius: 3px;
  }

  footer {
    background: var(--dark);
    color: var(--gray4);
    text-align: center;
    padding: 16px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  footer em { color: var(--gray3); font-style: normal; }

  #file-input { display: none; }

  /* PRESETS */
  .preset-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--gray3);
    margin-bottom: -4px;
  }

  .preset-btns { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

  .btn-preset {
    background: var(--light);
    border: 1.5px solid var(--gray2);
    border-radius: 3px;
    color: var(--dark);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-weight: 700;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    padding: 8px 16px;
    transition: all 0.2s;
  }

  .btn-preset:hover { border-color: var(--sky); color: var(--sky); background: #EEF5FB; }
  .btn-preset.active { background: var(--blue2); color: var(--white); border-color: var(--blue2); }

  .btn-preset-clear {
    background: none;
    border: 1px solid var(--gray2);
    border-radius: 3px;
    color: var(--gray3);
    cursor: pointer;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 1px;
    padding: 6px 12px;
    text-transform: uppercase;
    transition: all 0.2s;
    margin-left: auto;
  }

  .btn-preset-clear:hover { border-color: var(--danger); color: var(--danger); }

  .divider-label {
    text-align: center;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.68rem;
    letter-spacing: 1.5px;
    color: var(--gray3);
    margin: 2px 0;
  }
</style>
</head>
<body>

<div class="header-stripe"></div>

<header>
  <div class="logo-wrap">
    <div class="logo-text" style="border-left:none; padding-left:0;">
      <h1>Filtro de L√≠neas</h1>
      <p>Procesamiento de archivos de texto</p>
    </div>
  </div>
  <div class="header-badge">Uso Interno</div>
</header>

<div class="nav-bar">
  <span>Sistemas</span>
  <span class="sep">‚Ä∫</span>
  <span class="active">Filtro de Archivos</span>
</div>

<div class="main">

  <!-- ARCHIVO DE ENTRADA -->
  <div class="card card-primary">
    <div class="card-title">Archivo de entrada</div>

    <!-- Drop zone (visible cuando no hay archivo) -->
    <div class="drop-zone" id="drop-zone"
         onclick="document.getElementById('file-input').click()"
         ondragover="onDragOver(event)"
         ondragleave="onDragLeave(event)"
         ondrop="onDrop(event)">
      <div class="dz-icon">üìÑ</div>
      <div class="dz-title">Arrastre su archivo aqu√≠</div>
      <div class="dz-sub">o haga clic para seleccionar</div>
      <button class="dz-btn" onclick="event.stopPropagation(); document.getElementById('file-input').click()">
        Seleccionar archivo .txt
      </button>
    </div>

    <input type="file" id="file-input" accept=".txt,.log,.csv" onchange="loadFile(event)">

    <!-- Info del archivo cargado (oculto inicialmente) -->
    <div class="file-loaded" id="file-loaded" style="display:none;">
      <div class="file-icon">üìÑ</div>
      <div class="file-info">
        <div class="file-name" id="file-name">‚Äî</div>
        <div class="file-meta" id="file-meta">‚Äî</div>
      </div>
      <button class="file-remove" onclick="clearFile()">‚úï Quitar</button>
    </div>

    <!-- Preview del contenido -->
    <div id="preview-wrap" style="display:none;">
      <div class="preview-label">Vista previa del archivo</div>
      <div class="preview-box" id="preview-box"></div>
    </div>
  </div>

  <!-- CONFIGURACI√ìN -->
  <div class="card card-accent">
    <div class="card-title">Cadenas de b√∫squeda</div>

    <div class="preset-label">Conjuntos predefinidos</div>
    <div class="preset-btns">
      <button class="btn-preset" id="preset-quequen" onclick="applyPreset('quequen')">üìç Quequ√©n</button>
      <button class="btn-preset" id="preset-politas" onclick="applyPreset('politas')">üìç Politas</button>
      <button class="btn-preset-clear" onclick="clearPreset()">‚úï Limpiar</button>
    </div>
    <div class="divider-label">‚Äî o ingrese cadenas manualmente ‚Äî</div>

    <div class="input-row">
      <input type="text" id="search-input"
        placeholder="Ingrese una cadena y presione Enter o Agregar..."
        onkeydown="if(event.key==='Enter') addTag()">
      <button class="btn-add" onclick="addTag()">+ Agregar</button>
    </div>

    <div id="tags-container">
      <div class="empty-state" id="empty-tags">Sin cadenas definidas</div>
    </div>

    <div class="options-row">
      <label class="option">
        <input type="checkbox" id="opt-case"> Sensible a may√∫sculas
      </label>
      <label class="option">
        <input type="checkbox" id="opt-regex"> Expresiones regulares
      </label>
      <label class="option">
        <input type="checkbox" id="opt-header" checked> Conservar encabezado (1¬™ l√≠nea)
      </label>
    </div>

    <div id="stats-container" style="display:none;">
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-value hl" id="stat-total">0</span>
          <span class="stat-label">Total</span>
        </div>
        <div class="stat">
          <span class="stat-value good" id="stat-kept">0</span>
          <span class="stat-label">Conservadas</span>
        </div>
        <div class="stat">
          <span class="stat-value bad" id="stat-removed">0</span>
          <span class="stat-label">Eliminadas</span>
        </div>
        <div class="stat">
          <span class="stat-value hl" id="stat-pct">0%</span>
          <span class="stat-label">Reducci√≥n</span>
        </div>
      </div>
    </div>
  </div>

  <!-- RESULTADO -->
  <div class="card card-full">
    <div class="card-title">Resultado del filtrado</div>
    <div id="output-empty" class="empty-state">El resultado aparecer√° aqu√≠ luego de ejecutar el filtro</div>
    <textarea class="result-area" id="output-text" style="display:none;" readonly></textarea>
    <div class="actions-row">
      <button class="btn-main" onclick="runFilter()">‚ö° Ejecutar filtro</button>
      <button class="btn-download" id="btn-download" onclick="downloadResult()" disabled>‚Üì Descargar resultado</button>
    </div>
  </div>

</div>

<footer>
  <em>Herramienta de uso interno</em> ‚Äî Gerencia de Sistemas
</footer>

<script>
  let tags = [];
  let fileContent = '';
  let fileName = '';

  /* ‚îÄ‚îÄ ARCHIVO ‚îÄ‚îÄ */
  function loadFile(e) {
    const file = e.target.files[0];
    if (!file) return;
    processFile(file);
    e.target.value = '';
  }

  function processFile(file) {
    fileName = file.name;
    const reader = new FileReader();
    reader.onload = ev => {
      fileContent = ev.target.result;
      showFileLoaded(file);
    };
    reader.readAsText(file, 'UTF-8');
  }

  function showFileLoaded(file) {
    const lines = fileContent.split('\n').length;
    const kb = (file.size / 1024).toFixed(1);

    document.getElementById('drop-zone').style.display   = 'none';
    document.getElementById('file-loaded').style.display = 'flex';
    document.getElementById('file-name').textContent     = fileName;
    document.getElementById('file-meta').textContent     = `${lines.toLocaleString('es-AR')} l√≠neas ¬∑ ${kb} KB`;

    // preview: primeras 20 l√≠neas
    const preview = fileContent.split('\n').slice(0, 20).join('\n');
    document.getElementById('preview-box').textContent  = preview;
    document.getElementById('preview-wrap').style.display = 'block';

    // reset output
    document.getElementById('output-text').style.display  = 'none';
    document.getElementById('output-empty').style.display = 'block';
    document.getElementById('stats-container').style.display = 'none';
    document.getElementById('btn-download').disabled = true;
  }

  function clearFile() {
    fileContent = '';
    fileName    = '';
    document.getElementById('drop-zone').style.display    = 'flex';
    document.getElementById('file-loaded').style.display  = 'none';
    document.getElementById('preview-wrap').style.display = 'none';
    document.getElementById('output-text').style.display  = 'none';
    document.getElementById('output-empty').style.display = 'block';
    document.getElementById('stats-container').style.display = 'none';
    document.getElementById('btn-download').disabled = true;
  }

  /* ‚îÄ‚îÄ DRAG & DROP ‚îÄ‚îÄ */
  function onDragOver(e) {
    e.preventDefault();
    document.getElementById('drop-zone').classList.add('dragover');
  }

  function onDragLeave(e) {
    document.getElementById('drop-zone').classList.remove('dragover');
  }

  function onDrop(e) {
    e.preventDefault();
    document.getElementById('drop-zone').classList.remove('dragover');
    const file = e.dataTransfer.files[0];
    if (file) processFile(file);
  }

  /* ‚îÄ‚îÄ TAGS ‚îÄ‚îÄ */
  function addTag() {
    const input = document.getElementById('search-input');
    const val = input.value.trim();
    if (!val || tags.includes(val)) { input.value = ''; return; }
    tags.push(val);
    input.value = '';
    renderTags();
  }

  function removeTag(i) {
    tags.splice(i, 1);
    renderTags();
  }

  function renderTags() {
    const container = document.getElementById('tags-container');
    const empty = document.getElementById('empty-tags');
    if (tags.length === 0) {
      container.innerHTML = '';
      container.appendChild(empty);
      return;
    }
    container.innerHTML = '';
    const wrap = document.createElement('div');
    wrap.className = 'tags-wrap';
    tags.forEach((t, i) => {
      const tag = document.createElement('div');
      tag.className = 'tag';
      tag.innerHTML = `<span>${escapeHtml(t)}</span><button onclick="removeTag(${i})" title="Eliminar">√ó</button>`;
      wrap.appendChild(tag);
    });
    container.appendChild(wrap);
  }

  function escapeHtml(s) {
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  /* ‚îÄ‚îÄ FILTRO ‚îÄ‚îÄ */
  function runFilter() {
    if (!fileContent) { alert('Por favor cargue un archivo primero.'); return; }
    if (tags.length === 0) { alert('Agregue al menos una cadena de b√∫squeda.'); return; }

    const caseSensitive = document.getElementById('opt-case').checked;
    const useRegex      = document.getElementById('opt-regex').checked;
    const keepHeader    = document.getElementById('opt-header').checked;

    const lines = fileContent.split('\n');
    const header = keepHeader && lines.length > 0 ? lines[0] : null;
    const bodyLines = keepHeader ? lines.slice(1) : lines;

    let matchers;
    try {
      matchers = tags.map(t => {
        if (useRegex) return new RegExp(t, caseSensitive ? '' : 'i');
        const escaped = t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        return new RegExp(escaped, caseSensitive ? '' : 'i');
      });
    } catch(err) {
      alert('Error en expresi√≥n regular: ' + err.message);
      return;
    }

    const filteredBody = bodyLines.filter(line => matchers.some(rx => rx.test(line)));
    const kept = header !== null ? [header, ...filteredBody] : filteredBody;

    const total        = bodyLines.length;
    const keptCount    = filteredBody.length;
    const removedCount = total - keptCount;
    const pct = total > 0 ? Math.round((removedCount / total) * 100) : 0;

    document.getElementById('stat-total').textContent   = total.toLocaleString('es-AR');
    document.getElementById('stat-kept').textContent    = keptCount.toLocaleString('es-AR');
    document.getElementById('stat-removed').textContent = removedCount.toLocaleString('es-AR');
    document.getElementById('stat-pct').textContent     = pct + '%';
    document.getElementById('stats-container').style.display = 'block';

    const outTA = document.getElementById('output-text');
    outTA.value = kept.join('\n');
    outTA.style.display = 'block';
    document.getElementById('output-empty').style.display = 'none';
    document.getElementById('btn-download').disabled = false;
    outTA.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  /* ‚îÄ‚îÄ DESCARGA ‚îÄ‚îÄ */
  function downloadResult() {
    const text = document.getElementById('output-text').value;
    if (!text) return;
    const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    // Usar el mismo nombre del archivo original
    a.download = fileName || 'resultado_filtrado.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  }

  /* ‚îÄ‚îÄ PRESETS ‚îÄ‚îÄ */
  const PRESETS = {
    quequen: { label: 'Quequ√©n', tags: ['30981210', '30983720', '30983759', '30983761'] },
    politas: { label: 'Politas', tags: ['32254772', '32245217', '32254757', '32254807'] }
  };

  let activePreset = null;

  function applyPreset(key) {
    activePreset = key;
    tags = [...PRESETS[key].tags];
    renderTags();
    document.getElementById('preset-quequen').classList.toggle('active', key === 'quequen');
    document.getElementById('preset-politas').classList.toggle('active', key === 'politas');
  }

  function clearPreset() {
    activePreset = null;
    tags = [];
    renderTags();
    document.getElementById('preset-quequen').classList.remove('active');
    document.getElementById('preset-politas').classList.remove('active');
  }

</script>
</body>
</html>
